"use strict";!function(t,a){var i,o=ax5.util,e=function(){var e;a&&a.call(this),this.name="ax5grid",this.version="0.0.2",this.config={clickEventName:"click",theme:"default",animateTime:250,frozenColumnIndex:0,frozenRowIndex:0,rightSum:!1,footSum:!1,showLineNumber:!1,showRowSelector:!1,height:400,columnMinWidth:100,asideColumnWidth:30,header:{columnHeight:23,columnPadding:3,columnBorderWidth:1},body:{columnHeight:23,columnPadding:3,columnBorderWidth:1},scroller:{size:15}},this.colGroup=[],this.data=[],e=this.config;var d=function(t){var a={rows:[]},i=0,o=function d(t,o,r){for(var n={cols:[]},l=0,s=t.length;s>l;l++){var h=t[l],c=1;h.hidden||(h.colspan=1,h.rowspan=1,h.rowIndex=o,h.colIndex=function(){return r?(i=r.colIndex+l+1,r.colIndex+l):i++}(),n.cols.push(h),"columns"in h?c=d(h.columns,o+1,h):h.width="width"in h?h.width:e.columnMinWidth,h.colspan=c)}return n.cols.length>0?(a.rows[o]||(a.rows[o]={cols:[]}),a.rows[o].cols=a.rows[o].cols.concat(n.cols),n.cols.length-1+c):c};return o(t,0),function(){for(var t=0,i=a.rows.length;i>t;t++)for(var o=a.rows[t],e=0,d=o.cols.length;d>e;e++){var r=o.cols[e];"columns"in r||(r.rowspan=i-t)}}(),a},r=function(){var t={instanceId:this.id};return this.$target.html(i.tmpl.get("main",t)),this.$={container:{root:this.$target.find('[data-ax5grid-container="root"]'),header:this.$target.find('[data-ax5grid-container="header"]'),body:this.$target.find('[data-ax5grid-container="body"]'),scroller:this.$target.find('[data-ax5grid-container="scroller"]')},panel:{"aside-header":this.$target.find('[data-ax5grid-panel="aside-header"]'),"left-header":this.$target.find('[data-ax5grid-panel="left-header"]'),header:this.$target.find('[data-ax5grid-panel="header"]'),"header-scroll":this.$target.find('[data-ax5grid-panel-scroll="header"]'),"right-header":this.$target.find('[data-ax5grid-panel="right-header"]'),"top-aside-body":this.$target.find('[data-ax5grid-panel="top-aside-body"]'),"top-left-body":this.$target.find('[data-ax5grid-panel="top-left-body"]'),"top-body":this.$target.find('[data-ax5grid-panel="top-body"]'),"top-body-scroll":this.$target.find('[data-ax5grid-panel-scroll="top-body"]'),"top-right-body":this.$target.find('[data-ax5grid-panel="top-right-body"]'),"aside-body":this.$target.find('[data-ax5grid-panel="aside-body"]'),"aside-body-scroll":this.$target.find('[data-ax5grid-panel-scroll="aside-body"]'),"left-body":this.$target.find('[data-ax5grid-panel="left-body"]'),"left-body-scroll":this.$target.find('[data-ax5grid-panel-scroll="left-body"]'),body:this.$target.find('[data-ax5grid-panel="body"]'),"body-scroll":this.$target.find('[data-ax5grid-panel-scroll="body"]'),"right-body":this.$target.find('[data-ax5grid-panel="right-body"]'),"right-body-scroll":this.$target.find('[data-ax5grid-panel-scroll="right-body"]'),"bottom-aside-body":this.$target.find('[data-ax5grid-panel="bottom-aside-body"]'),"bottom-left-body":this.$target.find('[data-ax5grid-panel="bottom-left-body"]'),"bottom-body":this.$target.find('[data-ax5grid-panel="bottom-body"]'),"bottom-body-scroll":this.$target.find('[data-ax5grid-panel-scroll="bottom-body"]'),"bottom-right-body":this.$target.find('[data-ax5grid-panel="bottom-right-body"]')},scroller:{vertical:this.$target.find('[data-ax5grid-scroller="vertical"]'),"vertical-bar":this.$target.find('[data-ax5grid-scroller="vertical-bar"]'),horizontal:this.$target.find('[data-ax5grid-scroller="horizontal"]'),"horizontal-bar":this.$target.find('[data-ax5grid-scroller="horizontal-bar"]'),corner:this.$target.find('[data-ax5grid-scroller="corner"]')}},this.$.container.root.css({height:e.height}),this},n=function(t){this.columns=o.deepCopy(t),this.headerTable=d.call(this,this.columns);for(var a={},i=0,e=this.headerTable.rows.length;e>i;i++)for(var r=this.headerTable.rows[i],n=0,l=r.cols.length;l>n;n++)a[r.cols[n].colIndex]=jQuery.extend({},r.cols[n]);this.colGroup=[];for(var s in a)this.colGroup.push(a[s]);return this},l=function(){var t,a,i,e=this.$.container.root.width(),d=0,r=[],n=this.colGroup;for(a=0,i=n.length;i>a;a++)o.isNumber(n[a].width)?d+=n[a]._width=n[a].width:"*"===n[a].width?r.push(a):"%"===o.right(n[a].width,1)&&(d+=n[a]._width=e*o.left(n[a].width,"%")/100);if(r.length>0)for(t=(e-d)/r.length,a=0,i=r.length;i>a;a++)n[r[a]]._width=t},s=function(t){var a=this.$.container.root.width(),i=this.$.container.root.height(),o=e.asidePanelWidth=function(){var t=0;return e.showLineNumber&&(t+=e.asideColumnWidth),e.showRowSelector&&(t+=e.asideColumnWidth),t}(),d=e.frozenPanelWidth=function(t,a){for(var i=0,o=0,e=a;e>o;o++)i+=t[o]._width;return i}(this.colGroup,e.frozenColumnIndex),r=0,n=0,l=0,s=this.headerTable.rows.length*e.header.columnHeight,h=i-s,c=function(t,i,c,g){var u={},p=!1;switch(c){case"aside":0===o?(t.hide(),p=!0):(u.left=0,u.width=o);break;case"left":0===e.frozenColumnIndex?(t.hide(),p=!0):(u.left=o,u.width=d);break;case"right":e.rightSum||(t.hide(),p=!0);break;default:0===e.frozenColumnIndex?(u.left=o,u.width=a-r):(u.left=d+o,u.width=a-r-d)}if(p)return this;if("body"===g)switch(i){case"top":0===e.frozenRowIndex?(t.hide(),p=!0):(u.top=0,u.height=n);break;case"bottom":e.footSum?(u.top=h-l,u.height=l):(t.hide(),p=!0);break;default:u.top=0,u.height=h,0===e.frozenRowIndex&&(u.top=n,u.height=h-n),e.footSum&&(u.height-=l)}else"header"===g&&(u.height=s);return p?this:(t.css(u),this)};this.$.container.header.css({height:s}),this.$.container.body.css({height:h}),c.call(this,this.$.panel["aside-header"],"","aside","header"),c.call(this,this.$.panel["left-header"],"","left","header"),c.call(this,this.$.panel.header,"","","header"),c.call(this,this.$.panel["right-header"],"","right","header"),c.call(this,this.$.panel["top-aside-body"],"top","aside","body"),c.call(this,this.$.panel["top-left-body"],"top","left","body"),c.call(this,this.$.panel["top-body"],"top","","body"),c.call(this,this.$.panel["top-right-body"],"top","right","body"),c.call(this,this.$.panel["aside-body"],"","aside","body"),c.call(this,this.$.panel["left-body"],"","left","body"),c.call(this,this.$.panel.body,"","","body"),c.call(this,this.$.panel["right-body"],"","right","body"),c.call(this,this.$.panel["bottom-aside-body"],"bottom","aside","body"),c.call(this,this.$.panel["bottom-left-body"],"bottom","left","body"),c.call(this,this.$.panel["bottom-body"],"bottom","","body"),c.call(this,this.$.panel["bottom-right-body"],"bottom","right","body")};this.init=function(t){this.onStateChanged=e.onStateChanged,this.onClick=e.onClick;var a=this.gridConfig=jQuery.extend(!0,{},e,t);return a.target?(this.$target=jQuery(a.target),this.id||(this.id=this.$target.data("data-ax5grid-id")),this.id||(this.id="ax5grid-"+ax5.getGuid(),this.$target.data("data-ax5grid-id",a.id)),function(t){o.isObject(t)&&!t.error&&(a=jQuery.extend(!0,a,t))}(o.parseJson(this.$target.attr("data-ax5grid-config"),!0)),r.call(this),n.call(this,a.columns),l.call(this),s.call(this,!0),i.header.init.call(this),i.header.repaint.call(this),i.body.init.call(this),i.body.repaint.call(this),this):(console.log(ax5.info.getError("ax5grid","401","init")),this)},this.align=function(){return s.call(this),this},this.setData=function(t){return i.data.set.call(this,t),i.body.repaint.call(this),this},this.main=function(){t.grid_instance=t.grid_instance||[],t.grid_instance.push(this),arguments&&o.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};i=t.grid=function(){return o.isFunction(a)&&(e.prototype=new a),e}()}(ax5.ui,ax5.ui.root),function(t){var a=function(){this.bodyRowTable={},this.leftBodyRowData={},this.bodyRowData={},this.rightBodyRowData={},this.bodyRowTable=i.call(this,this.columns),this.config.bodyTrHeight=this.bodyRowTable.rows.length*this.config.body.columnHeight},i=function(t){var a={rows:[]},i=0,o=function e(t,o,d){for(var r={cols:[]},n=0,l=t.length,s=(function g(t){for(var a=0,n=t.length;n>a;a++){var l=t[a],s=1;l.hidden||("key"in l?(l.colspan=1,l.rowspan=1,l.rowIndex=o,l.colIndex=function(){return d?(i=d.colIndex+a+1,d.colIndex+a):i++}(),r.cols.push(l),"columns"in l&&(s=e(l.columns,o+1,l)),l.colspan=s):"columns"in l&&g(l.columns,o))}});l>n;n++){var h=t[n],c=1;h.hidden||("key"in h?(h.colspan=1,h.rowspan=1,h.rowIndex=o,h.colIndex=function(){return d?(i=d.colIndex+n+1,d.colIndex+n):i++}(),r.cols.push(h),"columns"in h&&(c=e(h.columns,o+1,h)),h.colspan=c):"columns"in h&&s(h.columns,o))}return r.cols.length>0?(a.rows[o]||(a.rows[o]={cols:[]}),a.rows[o].cols=a.rows[o].cols.concat(r.cols),r.cols.length-1+c):c};return o(t,0),function(){for(var t=0,i=a.rows.length;i>t;t++)for(var o=a.rows[t],e=0,d=o.cols.length;d>e;e++){var r=o.cols[e];"columns"in r||(r.rowspan=i-t)}}(),a},o=function(){var a=this.config,i=t.util.divideTableByFrozenColumnIndex(this.bodyRowTable,this.config.frozenColumnIndex),o=this.asideBodyRowData=function(t){for(var i={rows:[]},o=0,e=t.rows.length;e>o;o++)if(i.rows[o]={cols:[]},0===o){var d={width:a.asideColumnWidth,_width:a.asideColumnWidth,label:"",colspan:1,rowspan:t.rows.length,colIndex:null},r={};a.showLineNumber&&(r=jQuery.extend({},d,{label:"&nbsp;",key:"__d-index__"}),i.rows[o].cols.push(r)),a.showRowSelector&&(r=jQuery.extend({},d,{label:"",key:"__d-checkbox__"}),i.rows[o].cols.push(r))}return i}.call(this,this.bodyRowTable),e=this.leftBodyRowData=i.leftData,d=this.bodyRowData=i.rightData,r=this.data,n=Math.ceil(this.$.panel.body.height()/this.config.bodyTrHeight),l=Math.floor(Math.abs(this.$.panel["body-scroll"].position().top)/this.config.bodyTrHeight),s=function(t,i,o,e){var d,r,s,h,c,g,u,p,f,b,x,y=[],m=function(t,a,i){return"__d-index__"===i?a+1:"__d-checkbox__"===i?"C":t[i]||"&nbsp;"};for(y.push('<table border="0" cellpadding="0" cellspacing="0">'),y.push("<colgroup>"),d=0,r=i.length;r>d;d++)y.push('<col style="width:'+i[d]._width+'px;"  />');for(y.push("<col  />"),y.push("</colgroup>"),s=l,h=function(){var t;return t=e.length,t>n+l&&(t=n+l),t}();h>s;s++)for(c=0,g=o.rows.length;g>c;c++){for(y.push('<tr class="tr-'+s%4+'" data-ax5grid-data-index="'+s+'">'),u=0,p=o.rows[c].cols.length;p>u;u++)f=o.rows[c].cols[u],b=a.body.columnHeight*f.rowspan-a.body.columnBorderWidth,x="",a.body.columnBorderWidth&&(x+="hasBorder "),u==p-1&&(x+="isLastColumn "),y.push("<td ",'data-ax5grid-column-row="'+c+'" ','data-ax5grid-column-col="'+u+'" ','data-ax5grid-data-index="'+s+'" ','colspan="'+f.colspan+'" rowspan="'+f.rowspan+'" ','class="'+x+'" ','style="height: '+b+'px;min-height: 1px;">'),y.push(function(){var t=a.body.columnHeight-2*a.body.columnPadding-a.body.columnBorderWidth;return f.multiLine?'<span data-ax5grid-cellHolder="multiLine" style="height:'+b+"px;line-height: "+t+'px;">':'<span data-ax5grid-cellHolder="" style="height: '+(a.body.columnHeight-a.body.columnBorderWidth)+"px;line-height: "+t+'px;">'}(),m.call(this,e[s],s,f.key),"</span>"),y.push("</td>");y.push("<td ",'data-ax5grid-column-row="null" ','data-ax5grid-column-col="null" ','data-ax5grid-data-index="'+s+'" ','style="height: '+a.body.columnHeight+'px;min-height: 1px;" ',"></td>"),y.push("</tr>")}y.push("</table>"),t.html(y.join(""))};a.asidePanelWidth>0&&(a.frozenRowIndex>0&&s(this.$.panel["top-aside-body"],this.asideColGroup,o,r),s(this.$.panel["aside-body-scroll"],this.asideColGroup,o,r),a.footSum&&s(this.$.panel["bottom-aside-body"],this.asideColGroup,o,r)),a.frozenRowIndex>0,a.frozenColumnIndex>0&&s(this.$.panel["left-body-scroll"],this.leftHeaderColGroup,e,r),s(this.$.panel["body-scroll"],this.headerColGroup,d,r),a.rightSum,a.footSum},e=function(){};t.body={init:a,repaint:o,setData:e}}(ax5.ui.grid),function(t){var a=ax5.util,i=function(){},o=function(t){return this.data=a.deepCopy(t),this},e=function(){};t.data={init:i,set:o,get:e}}(ax5.ui.grid),function(t){var a=function(){this.leftHeaderData={},this.headerData={},this.rightHeaderData={}},i=function(){var a=this.config,i=t.util.divideTableByFrozenColumnIndex(this.headerTable,this.config.frozenColumnIndex),o=this.asideHeaderData=function(t){for(var i=[],o={rows:[]},e=0,d=t.rows.length;d>e;e++)if(o.rows[e]={cols:[]},0===e){var r={width:a.asideColumnWidth,_width:a.asideColumnWidth,label:"",colspan:1,rowspan:t.rows.length,key:"__dindex__",colIndex:null},n={};a.showLineNumber&&(n=jQuery.extend({},r,{label:"&nbsp;"}),i.push(n),o.rows[e].cols.push(n)),a.showRowSelector&&(n=jQuery.extend({},r,{label:""}),i.push(n),o.rows[e].cols.push(n))}return this.asideColGroup=i,o}.call(this,this.headerTable),e=this.leftHeaderData=i.leftData,d=this.headerData=i.rightData;this.leftHeaderColGroup=this.colGroup.slice(0,this.config.frozenColumnIndex),this.headerColGroup=this.colGroup.slice(this.config.frozenColumnIndex);var r=function(t,i,o){var e=[];e.push('<table border="0" cellpadding="0" cellspacing="0">'),e.push("<colgroup>");for(var d=0,r=i.length;r>d;d++)e.push('<col style="width:'+i[d]._width+'px;"  />');e.push("<col  />"),e.push("</colgroup>");for(var n=0,l=o.rows.length;l>n;n++){var s="";e.push('<tr class="'+s+'">');for(var h=0,c=o.rows[n].cols.length;c>h;h++){var g=o.rows[n].cols[h],u=a.header.columnHeight*g.rowspan-a.header.columnBorderWidth,p="";a.header.columnBorderWidth&&(p+="hasBorder "),h==c-1&&(p+="isLastColumn "),e.push("<td ",'data-ax5grid-column-row="'+n+'" ','data-ax5grid-column-col="'+h+'" ','colspan="'+g.colspan+'" rowspan="'+g.rowspan+'" ','class="'+p+'" ','style="height: '+u+'px;min-height: 1px;">'),e.push(function(){var t=a.header.columnHeight-2*a.header.columnPadding-a.header.columnBorderWidth;return g.multiLine?'<span data-ax5grid-cellHolder="multiLine" style="height:'+u+"px;line-height: "+t+'px;">':'<span data-ax5grid-cellHolder="" style="height: '+(a.header.columnHeight-a.header.columnBorderWidth)+"px;line-height: "+t+'px;">'}(),g.label||"&nbsp;","</span>"),e.push("</td>")}e.push("<td ",'data-ax5grid-column-row="null" ','data-ax5grid-column-col="null" ','style="height: '+a.header.columnHeight+'px;min-height: 1px;" ',"></td>"),e.push("</tr>")}e.push("</table>"),t.html(e.join(""))};a.asidePanelWidth>0&&r(this.$.panel["aside-header"],this.asideColGroup,o),a.frozenColumnIndex>0&&r(this.$.panel["left-header"],this.leftHeaderColGroup,e),r(this.$.panel["header-scroll"],this.headerColGroup,d),a.rightSum};t.header={init:a,repaint:i}}(ax5.ui.grid),function(t){var a=function(){};t.scroller={init:a}}(ax5.ui.grid),function(t){var a='<div data-ax5grid-container="root" data-ax5grid-instance="{{instanceId}}">\n            <div data-ax5grid-container="header">\n                <div data-ax5grid-panel="aside-header"></div>\n                <div data-ax5grid-panel="left-header"></div>\n                <div data-ax5grid-panel="header">\n                    <div data-ax5grid-panel-scroll="header"></div>\n                </div>\n                <div data-ax5grid-panel="right-header"></div>\n            </div>\n            <div data-ax5grid-container="body">\n                <div data-ax5grid-panel="top-aside-body"></div>\n                <div data-ax5grid-panel="top-left-body"></div>\n                <div data-ax5grid-panel="top-body">\n                    <div data-ax5grid-panel-scroll="top-body"></div>\n                </div>\n                <div data-ax5grid-panel="top-right-body"></div>\n                <div data-ax5grid-panel="aside-body">\n                    <div data-ax5grid-panel-scroll="aside-body"></div>\n                </div>\n                <div data-ax5grid-panel="left-body">\n                    <div data-ax5grid-panel-scroll="left-body"></div>\n                </div>\n                <div data-ax5grid-panel="body">\n                    <div data-ax5grid-panel-scroll="body"></div>\n                </div>\n                <div data-ax5grid-panel="right-body">\n                  <div data-ax5grid-panel-scroll="right-body"></div>\n                </div>\n                <div data-ax5grid-panel="bottom-aside-body"></div>\n                <div data-ax5grid-panel="bottom-left-body"></div>\n                <div data-ax5grid-panel="bottom-body">\n                    <div data-ax5grid-panel-scroll="bottom-body"></div>\n                </div>\n                <div data-ax5grid-panel="bottom-right-body"></div>\n            </div>\n            <div data-ax5grid-container="scroller">\n                <div data-ax5grid-scroller="vertical">\n                    <div data-ax5grid-scroller="vertical-bar"></div>    \n                </div>\n                <div data-ax5grid-scroller="horizontal">\n                    <div data-ax5grid-scroller="horizontal-bar"></div>\n                </div>\n                <div data-ax5grid-scroller="corner"></div>\n            </div>\n        </div>';t.tmpl={main:a,get:function(a,i){return ax5.mustache.render(t.tmpl[a],i)}}}(ax5.ui.grid),function(t){var a=function(t,a){for(var i={rows:[]},o={rows:[]},e=0,d=t.rows.length;d>e;e++){var r=t.rows[e];i.rows[e]={cols:[]},o.rows[e]={cols:[]};for(var n=0,l=r.cols.length;l>n;n++){var s=jQuery.extend({},r.cols[n]),h=s.colIndex,c=s.colIndex+s.colspan;if(a>h)if(a>=c)i.rows[e].cols.push(s);else{var g=jQuery.extend({},s),u=jQuery.extend({},g);g.colspan=a-g.colIndex,u.colIndex=a,u.colspan=s.colspan-g.colspan,i.rows[e].cols.push(g),o.rows[e].cols.push(u)}else o.rows[e].cols.push(s)}}return{leftData:i,rightData:o}};t.util={divideTableByFrozenColumnIndex:a}}(ax5.ui.grid);